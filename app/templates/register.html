{% extends "base.html" %}

{% block title %}Register{% endblock %}

{% block content %}
<div class="auth-container">
    <div class="card">
        <div class="card-body">
            <h4 class="card-title text-center mb-4">Create Account</h4>
            <p class="text-muted text-center small mb-4">Enter your email to get started. We'll send you a verification link.</p>
            
            <div class="mb-3">
                <label for="email" class="form-label">Email</label>
                <input type="email" class="form-control" id="email" placeholder="you@example.com">
            </div>
            
            <button class="btn btn-primary w-100" id="btnRegister">Send Verification Email</button>
            
            <div id="msg" class="mt-3 small" style="white-space: pre-wrap;"></div>
        </div>
    </div>
    
    <p class="text-center mt-3">
        Already have an account? <a href="{{ url_for('login') }}">Login</a>
    </p>
</div>
{% endblock %}

{% block scripts %}
<script>
document.getElementById("btnRegister").addEventListener("click", async () => {
    const email = document.getElementById("email").value;
    const msgEl = document.getElementById("msg");
    const btn = document.getElementById("btnRegister");
    
    if (!email) {
        msgEl.textContent = "Please enter your email";
        msgEl.className = "mt-3 small text-danger";
        return;
    }

    try {
        btn.disabled = true;
        btn.textContent = "Sending...";
        
        const response = await fetch("/login/email-request", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ 
                email: email,
                context: "register"
            }),
        });

        const data = await response.json();

        if (data.ok) {
            msgEl.textContent = data.message;
            msgEl.className = "mt-3 small text-success";
        } else {
            msgEl.textContent = data.error;
            msgEl.className = "mt-3 small text-danger";
            btn.disabled = false;
            btn.textContent = "Send Verification Email";
        }
    } catch (err) {
        msgEl.textContent = err.message;
        msgEl.className = "mt-3 small text-danger";
        btn.disabled = false;
        btn.textContent = "Send Verification Email";
    }
});

document.getElementById("email").addEventListener("keypress", (e) => {
    if (e.key === "Enter") document.getElementById("btnRegister").click();
});
</script>
{% endblock %}
