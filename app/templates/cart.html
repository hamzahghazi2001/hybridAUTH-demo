{% extends "base.html" %}

{% block title %}Cart{% endblock %}

{% block content %}
<h2 class="mb-4">Your Cart</h2>

<div class="card">
    <div class="card-body">
        <div id="cart-items">
            <p class="text-muted">Loading cart...</p>
        </div>
        
        <hr>
        
        <div class="d-flex justify-content-between align-items-center">
            <span class="fw-bold">Total: $<span id="cart-total">0.00</span></span>
            <div>
                <button class="btn btn-outline-secondary btn-sm" id="clear-cart">Clear Cart</button>
                <a href="{{ url_for('checkout') }}" class="btn btn-primary" id="checkout-btn">Proceed to Checkout</a>
            </div>
        </div>
    </div>
</div>

<div class="mt-3">
    <a href="{{ url_for('products') }}">&larr; Continue Shopping</a>
</div>
{% endblock %}

{% block scripts %}
<script>
function renderCart() {
    const cart = JSON.parse(localStorage.getItem('cart') || '[]');
    const container = document.getElementById('cart-items');
    const totalEl = document.getElementById('cart-total');
    const checkoutBtn = document.getElementById('checkout-btn');
    
    if (cart.length === 0) {
        container.innerHTML = '<p class="text-muted">Your cart is empty</p>';
        totalEl.textContent = '0.00';
        checkoutBtn.classList.add('disabled');
        return;
    }
    
    let html = '<table class="table"><thead><tr><th>Item</th><th>Price</th><th>Qty</th><th>Subtotal</th><th></th></tr></thead><tbody>';
    let total = 0;
    
    cart.forEach((item, idx) => {
        const subtotal = item.price * item.qty;
        total += subtotal;
        html += `<tr>
            <td>${item.name}</td>
            <td>$${item.price.toFixed(2)}</td>
            <td>${item.qty}</td>
            <td>$${subtotal.toFixed(2)}</td>
            <td><button class="btn btn-sm btn-outline-danger remove-item" data-idx="${idx}">Remove</button></td>
        </tr>`;
    });
    
    html += '</tbody></table>';
    container.innerHTML = html;
    totalEl.textContent = total.toFixed(2);
    checkoutBtn.classList.remove('disabled');
    
    document.querySelectorAll('.remove-item').forEach(btn => {
        btn.addEventListener('click', function() {
            const idx = parseInt(this.dataset.idx);
            cart.splice(idx, 1);
            localStorage.setItem('cart', JSON.stringify(cart));
            renderCart();
        });
    });
}

document.getElementById('clear-cart').addEventListener('click', () => {
    localStorage.removeItem('cart');
    renderCart();
});

renderCart();
</script>
{% endblock %}
